        -:    0:Source:randomtestcard2.c
        -:    0:Graph:randomtestcard2.gcno
        -:    0:Data:randomtestcard2.gcda
        -:    0:Runs:1
        -:    0:Programs:1
        -:    1:#include "dominion.h"
        -:    2:#include "dominion_helpers.h"
        -:    3:#include <string.h>
        -:    4:#include <stdio.h>
        -:    5:#include <assert.h>
        -:    6:#include <time.h>
        -:    7:#include "rngs.h"
        -:    8:#include <stdlib.h>
        -:    9:
        -:   10:// Globals (One to count hand/deck error, one for buy phase)
        -:   11:int failsCount = 0;
        -:   12:int failsBuy = 0;
        -:   13:int failsOtherPlayer = 0;
        -:   14:
     5000:   15:int checkCouncil(int x, struct gameState *post) {
     5000:   16:  int bonus = 0;
        -:   17:
        -:   18:  // Like testDrawCard, game state variable that allow
        -:   19:  // manual testing of function actions
        -:   20:  struct gameState pre;
     5000:   21:  memcpy (&pre, post, sizeof(struct gameState));
        -:   22:  
        -:   23:  // Call council room card effect
     5000:   24:  cardEffect(council_room, 0, 0, 0, post, 0, &bonus);  
        -:   25:
        -:   26:  // Break apart the council room effect into multiple parts
        -:   27:  // It draws 4 cards, adds a buy phase, and discards itself.
     5000:   28:  drawCard(x, &pre);
     5000:   29:  drawCard(x, &pre);
     5000:   30:  drawCard(x, &pre);
     5000:   31:  drawCard(x, &pre);
     5000:   32:  pre.numBuys++;
     5000:   33:  discardCard(0, x, &pre, 0);
        -:   34:
        -:   35:  // Have every other player draw a card
        -:   36:  int i;
    17429:   37:  for (i = 0; i < pre.numPlayers; i++) {
    12429:   38:    if (i != x) {
     9297:   39:      drawCard(i, &pre); 
        -:   40:    }
        -:   41:  }
        -:   42:
        -:   43:  // Compare the other player hands pre and post game
    17429:   44:  for (i = 0; i < pre.numPlayers; i++) {
    12429:   45:    if (i != x) {
    18584:   46:      if (!(pre.handCount[i] == post->handCount[i] &&
     9287:   47:            pre.deckCount[i] == post->deckCount[i])) {
       10:   48:              failsOtherPlayer++;
        -:   49:      } 
        -:   50:    }
        -:   51:  }
        -:   52:
        -:   53:  // Hand and deck counts
        -:   54:  // Booleans to determine equality
     5000:   55:  int handCount = 0;
     5000:   56:  int deckCount = 0;
        -:   57:
        -:   58:  // If the counts are equal return true (1)
     5000:   59:  if (pre.handCount[x] == post->handCount[x]) {
        2:   60:    handCount = 1;
        -:   61:  }
     5000:   62:  if (pre.deckCount[x] == post->deckCount[x]) {
        2:   63:    deckCount = 1;
        -:   64:  }
        -:   65:
        -:   66:  // If both true, test is okay. Otherwise, increment fails.
     5000:   67:  if (handCount == 1 && deckCount == 1) {
        -:   68:    //printf("Test for hand/deck count success.\n");
        -:   69:  } else {
     4998:   70:    failsCount++;
        -:   71:  }
        -:   72:
        -:   73:  // If buy count is equal, test is okay. Otherwise, increment fails.
     5000:   74:  if (pre.numBuys != post->numBuys) {
        5:   75:    failsBuy++;
        -:   76:  }
     5000:   77:}
        -:   78:
        1:   79:int main () {
        -:   80:
        1:   81:  printf("\nRandom Test for Council Room Card\n");
        -:   82:  
        -:   83:  // Initialize the game varibles
        1:   84:  int k[10] = {adventurer, council_room, feast, gardens, mine,
        -:   85:	       remodel, smithy, village, baron, great_hall};
        1:   86:  int tests = 5000;
        -:   87:  struct gameState G;
        -:   88:  int i, j, l, p;
        -:   89:  int deckCount, discardCount, handCount;
        1:   90:  srand(time(NULL));
        -:   91:
        -:   92:  // Randomize the game state
     5001:   93:  for (i = 0; i < tests; i++) {
131505000:   94:    for (j = 0; j < sizeof(struct gameState); j++) {
131500000:   95:      ((char*)&G)[i] = floor(Random() * 256);
        -:   96:    }
     5000:   97:    G.numPlayers = (rand() % 4) + 1;
        -:   98:    //printf("Players: %d\n", G.numPlayers);
     5000:   99:    G.numBuys = 1;
     5000:  100:    p = rand() % 4;
     5000:  101:    deckCount = floor(Random() * MAX_DECK);
     5000:  102:    discardCount = floor(Random() * MAX_DECK);
     5000:  103:    handCount = floor(Random() * MAX_HAND);
     5000:  104:    G.whoseTurn = p;
     5000:  105:    G.playedCardCount = floor(Random() * (MAX_DECK));
    17429:  106:    for (l = 0; l < G.numPlayers; l++) {
    12429:  107:      G.deckCount[l] = deckCount;
    12429:  108:      G.discardCount[l] = discardCount;
    12429:  109:      G.handCount[l] = handCount;
        -:  110:    }
        -:  111:
     5000:  112:    checkCouncil(p, &G);
        -:  113:  }
        -:  114:  
        -:  115:  // Print out results of random test.
        1:  116:  printf("\nResults of the tests\n");
        1:  117:  printf("FAILS: Hand or Deck Count doesn't match: %d\n", failsCount);
        1:  118:  printf("SUCCESS: Tests passed (Hand/Deck Count)- %d\n", tests - failsCount);
        1:  119:  printf("FAILS: Number of buys don't match: %d\n", failsBuy);
        1:  120:  printf("SUCCESS: Number of buys match - %d\n", tests - failsBuy);
        1:  121:  printf("FAILS: Other player draw unsuccessful: %d\n", failsOtherPlayer);
        1:  122:  printf("SUCCESS: Other player draw success: %d\n\n", tests - failsOtherPlayer);
        -:  123:
        1:  124:  return 0;
        -:  125:}
